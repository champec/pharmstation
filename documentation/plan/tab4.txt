Great question â€” the table/grid UI is arguably the most important UX decision you'll make. This is what pharmacists will stare at 8+ hours a day. Let me break down the options.

## Library Options for Data Tables

| Library | Pros | Cons | Verdict |
|---------|------|------|---------|
| **TanStack Table v8** | Headless (you own the UI), extremely flexible, React 19 compatible, huge community | You build ALL the UI yourself â€” every cell, every scroll, every interaction | âœ… **Best choice** |
| **AG Grid** | Enterprise-grade, Excel-like editing built in, inline editing native | Expensive ($1500+/dev), heavy bundle, opinionated styling, hard to customise to your brand | âŒ Overkill & expensive |
| **MUI DataGrid** | Good features, Material UI integration | Tied to MUI ecosystem, Pro features need license, not as flexible | âŒ Too opinionated |
| **Glide Data Grid** | Canvas-rendered, blazing fast, spreadsheet-feel | Less mature, fewer features, limited community | âš ï¸ Interesting but risky |
| **Custom from scratch** | Total control | Months of work reinventing the wheel | âŒ Not worth it |

## Recommendation: TanStack Table + Your Custom UI

TanStack Table is **headless** â€” it gives you all the logic (sorting, filtering, pagination, column management) but **zero UI**. You build every pixel yourself. This is perfect because:

1. âœ… You match your PharmStation brand exactly
2. âœ… You build the inline editing UX exactly how you want it
3. âœ… No fighting a library's opinions
4. âœ… Zero bundle bloat from UI you don't use
5. âœ… Works in React Native too (same logic, different render)
6. âœ… Free and open source

### The Stack for Tables

```
TanStack Table v8        â†’ Table logic (sorting, filtering, columns)
  +
Your custom components   â†’ Cell renderers, inline editors, modals
  +
Framer Motion            â†’ Smooth transitions, row animations
  +
cmdk or similar          â†’ Command palette for quick search
  +
React Hook Form + Zod    â†’ Form validation (for modal forms)
```

## The Two Input Modes You Described

### Mode 1: Inline Editing (The Register Feel)

This feels like writing in the physical register â€” you're looking at the page and typing directly into it. This is the **primary** mode.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CD Register â€” Morphine Sulfate 10mg/5ml Oral Solution                      â”‚
â”‚  Balance: 140        Ledger v7         [+ New Entry]  [Quick Scan ğŸ“·]       â”‚
â”œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  #  â”‚ Date     â”‚ Details      â”‚ In  â”‚ Out â”‚ Balance â”‚ Entered By            â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5  â”‚ 10/02/26 â”‚ Received     â”‚ 100 â”‚     â”‚   200   â”‚ Sarah Ahmed RPh       â”‚
â”‚     â”‚          â”‚ AAH Invoice  â”‚     â”‚     â”‚         â”‚ 10/02/26 09:14        â”‚
â”‚     â”‚          â”‚ #INV-44521   â”‚     â”‚     â”‚         â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  6  â”‚ 10/02/26 â”‚ Supplied to  â”‚     â”‚  30 â”‚   170   â”‚ James Wilson Tech     â”‚
â”‚     â”‚          â”‚ Mr J Smith   â”‚     â”‚     â”‚         â”‚ 10/02/26 11:32        â”‚
â”‚     â”‚          â”‚ 12 High St   â”‚     â”‚     â”‚         â”‚                       â”‚
â”‚     â”‚          â”‚ Dr Patel     â”‚     â”‚     â”‚         â”‚                       â”‚
â”‚     â”‚          â”‚ ğŸ“ Rx scan   â”‚     â”‚     â”‚         â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  7  â”‚ 11/02/26 â”‚ âš ï¸ Correction â”‚     â”‚  30 â”‚   140   â”‚ Sarah Ahmed RPh       â”‚
â”‚     â”‚          â”‚ Corrects #6  â”‚     â”‚     â”‚         â”‚ 11/02/26 08:45        â”‚
â”‚     â”‚          â”‚ "Qty was 20  â”‚     â”‚     â”‚         â”‚                       â”‚
â”‚     â”‚          â”‚  not 30"     â”‚     â”‚     â”‚         â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  8  â”‚ 11/02/26 â”‚ Supplied to  â”‚     â”‚  20 â”‚   120   â”‚ Sarah Ahmed RPh       â”‚
â”‚     â”‚          â”‚ Mr J Smith   â”‚     â”‚     â”‚         â”‚ 11/02/26 08:46        â”‚
â”‚     â”‚          â”‚ (correct qty)â”‚     â”‚     â”‚         â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚          â”‚              â”‚     â”‚     â”‚         â”‚                       â”‚
â”‚  9  â”‚ â–Š        â”‚              â”‚     â”‚     â”‚         â”‚ You (Sarah Ahmed)     â”‚
â”‚     â”‚          â”‚              â”‚     â”‚     â”‚         â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€ï¿½ï¿½ï¿½â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†‘ New entry row â€” Tab through cells to fill in, Enter to submit            â”‚
â”‚  Running balance will be calculated automatically                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Mode 2: Modal Form (For Complex Entries)

Click **[+ New Entry]** or double-click the new row to open a full form. Better for supplies (lots of fields) and when using AI scan.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  New CD Entry â€” Morphine Sulfate 10mg/5ml           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                     â”‚
â”‚  Transaction Type:  [Supply          â–¾]             â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€ Patient â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                                            â”‚     â”‚
â”‚  â”‚  Name:    [Mr J Smith         ] ğŸ” recent  â”‚     â”‚
â”‚  â”‚  Address: [12 High Street     ]            â”‚     â”‚
â”‚  â”‚           [London, SW1 2AB    ]            â”‚     â”‚
â”‚  â”‚                                            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€ Prescriber â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                                            â”‚     â”‚
â”‚  â”‚  Name:    [Dr Patel           ] ğŸ” recent  â”‚     â”‚
â”‚  â”‚  Address: [The Surgery        ]            â”‚     â”‚
â”‚  â”‚           [45 Main Rd, SW1    ]            â”‚     â”‚
â”‚  â”‚                                            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                     â”‚
â”‚  Quantity:   [20        ]                           â”‚
â”‚  Date:       [11/02/2026]                           â”‚
â”‚  Rx Date:    [10/02/2026]                           ï¿½ï¿½ï¿½
â”‚                                                     â”‚
â”‚  ğŸ“ Attach prescription scan  [Choose file / ğŸ“·]    â”‚
â”‚                                                     â”‚
â”‚  Notes:      [                          ]           â”‚
â”‚                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Current balance: 140                               â”‚
â”‚  After this entry: 120  (-20)                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                     â”‚
â”‚  [Cancel]                    [Submit Entry]          â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Reusable Patient & Prescriber Details

This is key â€” pharmacists enter the same patients and prescribers repeatedly. We need an autocomplete system that learns.

```sql
-- ============================================
-- KNOWN CONTACTS (patients & prescribers)
-- ============================================
-- These are NOT master records â€” they're autocomplete helpers
-- Built from historical entries + manual additions

CREATE TABLE known_contacts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organisation_id UUID NOT NULL REFERENCES organisations(id),
  
  contact_type TEXT NOT NULL CHECK (contact_type IN (
    'patient', 'prescriber'
  )),
  
  -- Details
  full_name TEXT NOT NULL,
  address_line_1 TEXT,
  address_line_2 TEXT,
  city TEXT,
  postcode TEXT,
  
  -- Prescriber-specific
  gmc_number TEXT,           -- for doctors
  gphc_number TEXT,          -- for pharmacist prescribers
  prescriber_type TEXT,      -- GP, dentist, nurse prescriber, etc.
  
  -- Patient-specific
  nhs_number TEXT,
  date_of_birth DATE,
  
  -- Usage tracking (for sorting by frequency)
  usage_count INTEGER DEFAULT 1,
  last_used_at TIMESTAMPTZ DEFAULT NOW(),
  
  created_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- Fuzzy matching index
  search_key TEXT GENERATED ALWAYS AS (
    lower(trim(full_name)) || ' ' || 
    COALESCE(lower(trim(postcode)), '')
  ) STORED
);

CREATE INDEX idx_contacts_search 
  ON known_contacts(organisation_id, contact_type, search_key);
CREATE INDEX idx_contacts_usage 
  ON known_contacts(organisation_id, contact_type, usage_count DESC);
```

### How Autocomplete Works

```typescript
// components/ContactAutocomplete.tsx

interface ContactAutocompleteProps {
  type: 'patient' | 'prescriber'
  onSelect: (contact: KnownContact) => void
  orgId: string
}

function ContactAutocomplete({ type, onSelect, orgId }: ContactAutocompleteProps) {
  const [query, setQuery] = useState('')
  const [results, setResults] = useState<KnownContact[]>([])
  const [isOpen, setIsOpen] = useState(false)

  // Debounced search
  useEffect(() => {
    if (query.length < 2) {
      setResults([])
      return
    }
    
    const timer = setTimeout(async () => {
      const { data } = await orgClient
        .from('known_contacts')
        .select('*')
        .eq('organisation_id', orgId)
        .eq('contact_type', type)
        .ilike('search_key', `%${query.toLowerCase()}%`)
        .order('usage_count', { ascending: false })
        .limit(10)
      
      setResults(data || [])
      setIsOpen(true)
    }, 200)
    
    return () => clearTimeout(timer)
  }, [query])

  return (
    <div className="relative">
      <input
        value={query}
        onChange={(e) => setQuery(e.target.value)}
        placeholder={`Start typing ${type} name...`}
        className="ps-input"
      />
      
      {isOpen && results.length > 0 && (
        <div className="absolute top-full mt-1 w-full bg-white 
                        rounded-lg shadow-lg border z-50">
          {results.map((contact) => (
            <button
              key={contact.id}
              onClick={() => {
                onSelect(contact)
                setQuery(contact.full_name)
                setIsOpen(false)
              }}
              className="w-full text-left px-4 py-3 hover:bg-sky-50
                         border-b last:border-b-0"
            >
              <div className="font-medium">{contact.full_name}</div>
              <div className="text-sm text-gray-500">
                {contact.address_line_1}
                {contact.postcode && `, ${contact.postcode}`}
              </div>
              {contact.prescriber_type && (
                <div className="text-xs text-blue-600 mt-1">
                  {contact.prescriber_type}
                </div>
              )}
            </button>
          ))}
          
          <button
            onClick={() => {
              onSelect({ full_name: query } as KnownContact)
              setIsOpen(false)
            }}
            className="w-full text-left px-4 py-2 text-sm 
                       text-blue-600 hover:bg-blue-50"
          >
            + Add "{query}" as new {type}
          </button>
        </div>
      )}
    </div>
  )
}
```

### Auto-learning: Update Contacts from Entries

```sql
-- After every entry, upsert the patient/prescriber into known_contacts
CREATE OR REPLACE FUNCTION learn_contacts_from_entry()
RETURNS TRIGGER AS $$
BEGIN
  -- Learn patient
  IF NEW.patient_name IS NOT NULL THEN
    INSERT INTO known_contacts (
      organisation_id, contact_type, full_name,
      address_line_1, last_used_at, usage_count
    ) VALUES (
      NEW.organisation_id, 'patient', NEW.patient_name,
      NEW.patient_address, NOW(), 1
    )
    ON CONFLICT (organisation_id, contact_type, 
                 lower(trim(full_name)), COALESCE(lower(trim(postcode)), ''))
    DO UPDATE SET
      usage_count = known_contacts.usage_count + 1,
      last_used_at = NOW(),
      -- Update address if newer
      address_line_1 = COALESCE(EXCLUDED.address_line_1, known_contacts.address_line_1);
  END IF;
  
  -- Learn prescriber
  IF NEW.prescriber_name IS NOT NULL THEN
    INSERT INTO known_contacts (
      organisation_id, contact_type, full_name,
      address_line_1, last_used_at, usage_count
    ) VALUES (
      NEW.organisation_id, 'prescriber', NEW.prescriber_name,
      NEW.prescriber_address, NOW(), 1
    )
    ON CONFLICT (organisation_id, contact_type,
                 lower(trim(full_name)), COALESCE(lower(trim(postcode)), ''))
    DO UPDATE SET
      usage_count = known_contacts.usage_count + 1,
      last_used_at = NOW(),
      address_line_1 = COALESCE(EXCLUDED.address_line_1, known_contacts.address_line_1);
  END IF;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER learn_contacts
  AFTER INSERT ON register_entries
  FOR EACH ROW EXECUTE FUNCTION learn_contacts_from_entry();
```

## The Inline Editing Component

```typescript
// components/register/InlineEntryRow.tsx

interface InlineEntryRowProps {
  ledger: RegisterLedger
  lockVersion: number
  onEntrySubmitted: () => void
}

function InlineEntryRow({ ledger, lockVersion, onEntrySubmitted }: InlineEntryRowProps) {
  const { activeUser } = useStaff()
  const [isActive, setIsActive] = useState(false)
  const [transactionType, setTransactionType] = useState<string>('')
  const [formData, setFormData] = useState<Partial<EntryInput>>({})
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [showModal, setShowModal] = useState(false)
  
  // Cell refs for Tab navigation
  const dateRef = useRef<HTMLInputElement>(null)
  const typeRef = useRef<HTMLSelectElement>(null)
  const qtyRef = useRef<HTMLInputElement>(null)
  const detailsRef = useRef<HTMLInputElement>(null)

  const handleSubmit = async () => {
    if (isSubmitting) return
    setIsSubmitting(true)
    
    try {
      await makeRegisterEntry(ledger.id, {
        ...formData,
        registerType: ledger.register_type,
        entryType: 'normal',
        transactionType,
        enteredBy: activeUser.id,
        expectedLockVersion: lockVersion,
      })
      
      // Reset form
      setFormData({})
      setTransactionType('')
      onEntrySubmitted()  // Triggers refresh
      
    } catch (err) {
      if (err instanceof ConflictError) {
        toast.warning(
          'Another entry was just made. The register has been ' +
          'refreshed. Please review the new balance and resubmit.'
        )
        onEntrySubmitted()  // Refresh to get new data
      } else {
        toast.error('Failed to submit entry. Please try again.')
      }
    } finally {
      setIsSubmitting(false)
    }
  }

  // Handle Tab key to move between cells
  const handleKeyDown = (e: KeyboardEvent, nextRef: RefObject<HTMLElement>) => {
    if (e.key === 'Tab' && !e.shiftKey) {
      e.preventDefault()
      nextRef.current?.focus()
    }
    if (e.key === 'Enter' && e.ctrlKey) {
      handleSubmit()
    }
  }

  if (!isActive) {
    return (
      <tr 
        className="cursor-pointer hover:bg-sky-50/50 transition-colors"
        onClick={() => setIsActive(true)}
      >
        <td className="text-gray-400 text-center">
          {ledger.entry_count + 1}
        </td>
        <td colSpan={5} className="text-gray-400 italic pl-4">
          Click to add new entry, or press [+ New Entry] for full form...
        </td>
        <td className="text-sm text-gray-400">
          {activeUser?.full_name}
        </td>
      </tr>
    )
  }

  return (
    <tr className="bg-sky-50/30 border-2 border-sky-200">
      {/* Entry Number (auto) */}
      <td className="text-center font-mono text-sky-600">
        {ledger.entry_count + 1}
      </td>
      
      {/* Date */}
      <td className="p-1">
        <input
          ref={dateRef}
          type="date"
          defaultValue={new Date().toISOString().split('T')[0]}
          onChange={(e) => setFormData(prev => ({
            ...prev, dateOfTransaction: e.target.value
          }))}
          onKeyDown={(e) => handleKeyDown(e, typeRef)}
          className="ps-inline-input w-full"
          autoFocus
        />
      </td>
      
      {/* Transaction Type + Details */}
      <td className="p-1">
        <select
          ref={typeRef}
          value={transactionType}
          onChange={(e) => setTransactionType(e.target.value)}
          onKeyDown={(e) => handleKeyDown(e, detailsRef)}
          className="ps-inline-select w-full mb-1"
        >
          <option value="">Select type...</option>
          <option value="receipt">Receipt (stock in)</option>
          <option value="supply">Supply (to patient)</option>
          <option value="disposal">Disposal</option>
          <option value="patient_return">Patient return</option>
          <option value="return_to_supplier">Return to supplier</option>
        </select>
        
        {/* Context-dependent detail fields */}
        {transactionType === 'receipt' && (
          <div className="space-y-1">
            <input
              ref={detailsRef}
              placeholder="Supplier name"
              onChange={(e) => setFormData(prev => ({
                ...prev, supplierName: e.target.value
              }))}
              className="ps-inline-input w-full"
            />
            <input
              placeholder="Invoice number"
              onChange={(e) => setFormData(prev => ({
                ...prev, invoiceNumber: e.target.value
              }))}
              className="ps-inline-input w-full"
            />
          </div>
        )}
        
        {transactionType === 'supply' && (
          <div className="space-y-1">
            <ContactAutocomplete
              type="patient"
              orgId={ledger.organisation_id}
              onSelect={(contact) => setFormData(prev => ({
                ...prev,
                patientName: contact.full_name,
                patientAddress: contact.address_line_1,
              }))}
            />
            <ContactAutocomplete
              type="prescriber"
              orgId={ledger.organisation_id}
              onSelect={(contact) => setFormData(prev => ({
                ...prev,
                prescriberName: contact.full_name,
                prescriberAddress: contact.address_line_1,
              }))}
            />
          </div>
        )}
      </td>
      
      {/* Quantity In */}
      <td className="p-1">
        {['receipt', 'patient_return', 'transfer_in'].includes(transactionType) && (
          <input
            ref={qtyRef}
            type="number"
            min="0"
            step="any"
            placeholder="Qty"
            onChange={(e) => setFormData(prev => ({
              ...prev, quantityReceived: parseFloat(e.target.value)
            }))}
            className="ps-inline-input w-20 text-center font-mono"
          />
        )}
      </td>
      
      {/* Quantity Out */}
      <td className="p-1">
        {['supply', 'disposal', 'return_to_supplier', 'transfer_out'].includes(transactionType) && (
          <input
            type="number"
            min="0"
            step="any"
            placeholder="Qty"
            onChange={(e) => setFormData(prev => ({
              ...prev, quantityDeducted: parseFloat(e.target.value)
            }))}
            className="ps-inline-input w-20 text-center font-mono"
          />
        )}
      </td>
      
      {/* Balance (auto-calculated preview) */}
      <td className="text-center font-mono">
        <span className="text-sky-600">
          {calculatePreviewBalance(
            ledger.current_balance,
            formData.quantityReceived,
            formData.quantityDeducted
          )}
        </span>
        <span className="text-xs text-gray-400 block">
          (preview)
        </span>
      </td>
      
      {/* Actions */}
      <td className="p-1">
        <div className="flex items-center gap-1">
          <span className="text-xs text-gray-500">
            {activeUser?.full_name}
          </span>
          <button
            onClick={handleSubmit}
            disabled={isSubmitting || !transactionType}
            className="ps-btn-primary text-xs px-3 py-1"
          >
            {isSubmitting ? '...' : 'âœ“'}
          </button>
          <button
            onClick={() => setShowModal(true)}
            className="ps-btn-secondary text-xs px-2 py-1"
            title="Open full form"
          >
            â¬ˆ
          </button>
          <button
            onClick={() => setIsActive(false)}
            className="ps-btn-ghost text-xs px-2 py-1"
          >
            âœ•
          </button>
        </div>
      </td>
      
      {/* Full form modal */}
      {showModal && (
        <EntryFormModal
          ledger={ledger}
          lockVersion={lockVersion}
          initialData={formData}
          transactionType={transactionType}
          onClose={() => setShowModal(false)}
          onSubmitted={onEntrySubmitted}
        />
      )}
    </tr>
  )
}
```

## Custom CSS Classes for the PharmStation Look

```css
/* styles/register-table.css */

/* Inline input â€” looks like it's part of the table */
.ps-inline-input {
  border: 1px solid transparent;
  border-radius: 4px;
  padding: 4px 8px;
  font-size: 14px;
  background: transparent;
  transition: all 0.15s ease;
  color: #1a1a1a;
}

.ps-inline-input:hover {
  border-color: #9FCADE; /* Cloud Blue */
}

.ps-inline-input:focus {
  border-color: #04B0FF; /* Electric Cyan */
  background: white;
  outline: none;
  box-shadow: 0 0 0 3px rgba(4, 176, 255, 0.1);
}

/* Inline select */
.ps-inline-select {
  border: 1px solid transparent;
  border-radius: 4px;
  padding: 4px 8px;
  font-size: 14px;
  background: transparent;
  cursor: pointer;
}

.ps-inline-select:focus {
  border-color: #04B0FF;
  background: white;
  outline: none;
}

/* Register table */
.ps-register-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  font-size: 14px;
}

.ps-register-table th {
  background: #257BB4; /* Deep Blue */
  color: white;
  padding: 10px 12px;
  text-align: left;
  font-weight: 600;
  position: sticky;
  top: 0;
  z-index: 10;
}

.ps-register-table td {
  padding: 8px 12px;
  border-bottom: 1px solid #E5F2F7; /* Off-White */
  vertical-align: top;
}

.ps-register-table tr:hover {
  background: #f8fcfe;
}

/* Correction entries highlighted */
.ps-register-table tr[data-entry-type="correction"] {
  background: #FFF8E1;
  border-left: 3px solid #FFA000;
}

/* Annotated entries */
.ps-register-table tr[data-has-annotations="true"] td:first-child::after {
  content: "ğŸ“";
  font-size: 10px;
  margin-left: 4px;
}

/* Primary button */
.ps-btn-primary {
  background: #257BB4;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 8px 16px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.15s;
}

.ps-btn-primary:hover {
  background: #378FC2;
}

.ps-btn-primary:disabled {
  background: #8FA7B3;
  cursor: not-allowed;
}
```

## Summary of the Table Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TanStack Table                    â”‚
â”‚              (logic: sort, filter, paginate)         â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          Custom PharmStation UI                â”‚  â”‚
ï¿½ï¿½ï¿½  â”‚                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Read-only rows (existing entries)      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Immutable display                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Click to view details/annotations    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Correction entries highlighted       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Evidence attachments viewable        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Inline entry row (new entry)           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Tab through cells                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Context-dependent fields             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Autocomplete patients/prescribers    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Live balance preview                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Ctrl+Enter to submit                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ â¬ˆ button opens full modal form       â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Modal form (full entry form)           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ All fields visible                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ File upload for scans                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ React Hook Form + Zod validation     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Balance preview before submit        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚  Contact Autocomplete                               â”‚
â”‚  â€¢ Learns from entries (DB trigger)                 â”‚
â”‚  â€¢ Sorted by usage frequency                        â”‚
â”‚  â€¢ Fuzzy search                                     â”‚
â”‚  â€¢ Add new on the fly                               â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This gives you the best of both worlds â€” fast inline entry for simple transactions (receipts from suppliers), and a full modal form for complex ones (supplies with patient/prescriber details + prescription scan). The autocomplete learns from every entry, so after a few weeks the pharmacy barely has to type anything.

Want me to create a PR adding all of this to your documentation, or shall we work through the RP log UX next since that's a simpler register and a good starting point for building?

